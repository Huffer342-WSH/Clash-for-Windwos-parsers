parsers:
  - url: https://example.com/profile.yaml //å¡«å†™ä½ çš„ä»£ç†é…ç½®é“¾æ¥
    code: |
      module.exports.parse = async (raw, { axios, yaml, notify, console }, { name, url, interval, selected }) => {
          const obj = yaml.parse(raw)
          const newobj = {}
          //======================  å¼€å…³ ======================
          const enable_replace_rules = true
      
          //======================  å›ºå®šé…ç½® ======================
          newobj["mixed-port"] = 7890;
          newobj["allow-lan"] = true;
          newobj["bind-address"] = "*";
          newobj["mode"] = "rule";
          newobj["log-level"] = "info";
          newobj["external-controller"] = "127.0.0.1:9090";
          newobj["dns"] = {
              enable: true,
              ipv6: false,
              "default-nameserver": ["223.5.5.5", "119.29.29.29"],
              "enhanced-mode": "fake-ip",
              "fake-ip-range": "198.18.0.1/16",
              "use-hosts": true,
              nameserver: [
                  "https://doh.pub/dns-query",
                  "https://dns.alidns.com/dns-query",
              ],
              fallback: [
                  "https://1.1.1.1/dns-query",
                  "https://208.67.222.222/dns-query",
                  "https://dns.twnic.tw/dns-query",
                  "tls://8.8.4.4:853",
              ],
              "fallback-filter": {
                  geoip: true,
                  "geoip-code": "CN",
                  ipcidr: ["240.0.0.0/4", "0.0.0.0/32"],
              },
          };
      
          //======================  proxies ======================
          newobj["proxies"] = obj["proxies"]
      
          //======================  Proxy Group ======================
          newobj['proxy-groups'] = []
          function createProxyGroups(obj, name, auxStrings) {
              // ç›´æ¥åœ¨ filter ä¸­æå– name å±æ€§å¹¶è¿‡æ»¤
              const proxyNames = obj.proxies
                  .map(proxy => proxy.name)
                  .filter(proxyName => auxStrings.some(aux => proxyName.includes(aux)));
      
              if (proxyNames.length > 0) {
                  // åˆ›å»ºè‡ªåŠ¨é€‰æ‹©ç»„
                  const autoProxyGroup = {
                      name: `${name}-è‡ªåŠ¨é€‰æ‹©`,
                      type: 'url-test',
                      proxies: proxyNames,
                      url: 'http://www.gstatic.com/generate_204',
                      interval: 86400
                  };
      
                  // åˆ›å»ºé€‰æ‹©ç»„
                  const proxyGroup = {
                      name: name,
                      type: 'select',
                      proxies: [`${name}-è‡ªåŠ¨é€‰æ‹©`, ...proxyNames]
                  };
      
                  // è¿”å›è¿™ä¸¤ä¸ªç»„
                  return { autoProxyGroup, proxyGroup };
              }
      
              // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä»£ç†ï¼Œè¿”å› null
              return null;
          }
      
          function addProxyGroup(obj, listCountry, name, auxStrings) {
              const groupTemp = createProxyGroups(obj, name, auxStrings);
              if (groupTemp) {
                  const { autoProxyGroup, proxyGroup } = groupTemp;
                  obj['proxy-groups'].push(autoProxyGroup, proxyGroup);
                  listCountry.push(name);
              }
          }
      
          //èŠ‚ç‚¹åç§°åˆ†ç»„
      
          // æ‰€æœ‰èŠ‚ç‚¹
          const proxiesRAW = newobj.proxies.map(proxy => proxy.name);
      
          // æœ‰æ•ˆèŠ‚ç‚¹
          const proxiesUseful = proxiesRAW.filter(proxy => {
              return !proxy.includes('å‰©ä½™') && !proxy.includes('å¥—é¤') && !proxy.includes('ç½‘å€') && !proxy.includes('å®¢æœ') && !proxy.includes('è¿‡æ»¤');
          });
      
          // ç”Ÿæˆå„ä¸ªå›½å®¶çš„èŠ‚ç‚¹ç»„
          const proxiesCountries = [];//ç”¨äºä¿å­˜å„ä¸ªå›½å®¶èŠ‚ç‚¹ç»„çš„åç§°
          const proxyMatcher = [
              { name: 'èŠ‚ç‚¹ç»„-ç¾å›½', match: ['ç¾å›½', 'US', 'ğŸ‡ºğŸ‡¸'] },
              { name: 'èŠ‚ç‚¹ç»„-é¦™æ¸¯', match: ['é¦™æ¸¯', 'HK', 'ğŸ‡­ğŸ‡°'] },
              { name: 'èŠ‚ç‚¹ç»„-å°æ¹¾', match: ['å°æ¹¾', 'TW'] },
              { name: 'èŠ‚ç‚¹ç»„-æ—¥æœ¬', match: ['æ—¥æœ¬', 'JP'] },
              { name: 'èŠ‚ç‚¹ç»„-éŸ©å›½', match: ['éŸ©å›½', 'KR'] },
              { name: 'èŠ‚ç‚¹ç»„-æ¾³å¤§åˆ©äºš', match: ['æ¾³å¤§åˆ©äºš', 'AU'] },
              { name: 'èŠ‚ç‚¹ç»„-æ–°åŠ å¡', match: ['æ–°åŠ å¡', 'SG'] },
              { name: 'èŠ‚ç‚¹ç»„-æ³•å›½', match: ['æ³•å›½', 'FR'] },
              { name: 'èŠ‚ç‚¹ç»„-è‹±å›½', match: ['è‹±å›½', 'UK'] },
              { name: 'èŠ‚ç‚¹ç»„-å¾·å›½', match: ['å¾·å›½', 'DE'] },
              { name: 'èŠ‚ç‚¹ç»„-æ„å¤§åˆ©', match: ['æ„å¤§åˆ©', 'IT'] },
              { name: 'èŠ‚ç‚¹ç»„-ä¿„ç½—æ–¯', match: ['ä¿„ç½—æ–¯', 'RU'] },
          ];
      
          // éå†æ•°ç»„è°ƒç”¨ addProxyGroup
          proxyMatcher.forEach(group => {
              addProxyGroup(newobj, proxiesCountries, group.name, group.match);
          });
      
          const proxiesDefault = ['é»˜è®¤ä»£ç†', 'DIRECT', 'è´Ÿè½½å‡è¡¡-è½®è¯¢', 'è´Ÿè½½å‡è¡¡-ä¸€è‡´æ€§å“ˆå¸Œ', ...proxiesCountries, ...proxiesUseful];
          const proxiesChatgpt = proxiesUseful.filter(proxy => !proxy.includes('é¦™æ¸¯')); //GPTèŠ‚ç‚¹ç»„æ’é™¤é¦™æ¸¯
      
          const proxyGroupConfigs = [
              {
                  name: 'è‡ªåŠ¨é€‰æ‹©',
                  type: 'url-test',
                  proxies: proxiesUseful,
                  url: 'http://www.gstatic.com/generate_204',
                  interval: 86400,
              },
              {
                  name: 'è´Ÿè½½å‡è¡¡-è½®è¯¢',
                  type: 'load-balance',
                  proxies: proxiesUseful,
                  url: 'http://www.gstatic.com/generate_204',
                  interval: 86400,
                  strategy: 'round-robin',
                  lazy: true
              },
              {
                  name: 'è´Ÿè½½å‡è¡¡-ä¸€è‡´æ€§å“ˆå¸Œ',
                  type: 'load-balance',
                  proxies: proxiesUseful,
                  url: 'http://www.gstatic.com/generate_204',
                  interval: 86400,
                  strategy: 'consistent-hashing',
                  lazy: true
              },
              {
                  name: 'é»˜è®¤ä»£ç†',
                  type: 'select',
                  proxies: ['è‡ªåŠ¨é€‰æ‹©', 'DIRECT', 'è´Ÿè½½å‡è¡¡-è½®è¯¢', 'è´Ÿè½½å‡è¡¡-ä¸€è‡´æ€§å“ˆå¸Œ', ...proxiesCountries, ...proxiesRAW],
              },
              { name: 'chatgpt', type: 'select', proxies: [...proxiesChatgpt] },
              { name: 'bing', type: 'select', proxies: [...proxiesChatgpt] },
              { name: 'æˆ˜ç½‘', type: 'select', proxies: proxiesDefault },
              { name: 'Telegram', type: 'select', proxies: proxiesDefault },
              { name: 'è‹¹æœæœåŠ¡', type: 'select', proxies: proxiesDefault },
              { name: 'å¾®è½¯æœåŠ¡', type: 'select', proxies: proxiesDefault },
              { name: 'æ¼ç½‘ä¹‹é±¼', type: 'select', proxies: proxiesDefault },
          ];
      
          newobj['proxy-groups'].unshift(...proxyGroupConfigs);
      
      
      
      
          //////////////////////   Rule Providers  //////////////////////
          const newRuleProviders = {
              'reject': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt',
                  path: './ruleset/reject.yaml',
                  interval: 86400
              },
              'icloud': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt',
                  path: './ruleset/icloud.yaml',
                  interval: 86400
              },
              'apple': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt',
                  path: './ruleset/apple.yaml',
                  interval: 86400
              },
              'google': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt',
                  path: './ruleset/google.yaml',
                  interval: 86400
              },
              'proxy': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt',
                  path: './ruleset/proxy.yaml',
                  interval: 86400
              },
              'direct': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt',
                  path: './ruleset/direct.yaml',
                  interval: 86400
              },
              'private': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt',
                  path: './ruleset/private.yaml',
                  interval: 86400
              },
              'gfw': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt',
                  path: './ruleset/gfw.yaml',
                  interval: 86400
              },
              'tld-not-cn': {
                  type: 'http',
                  behavior: 'domain',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt',
                  path: './ruleset/tld-not-cn.yaml',
                  interval: 86400
              },
              'telegramcidr': {
                  type: 'http',
                  behavior: 'ipcidr',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt',
                  path: './ruleset/telegramcidr.yaml',
                  interval: 86400
              },
              'cncidr': {
                  type: 'http',
                  behavior: 'ipcidr',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt',
                  path: './ruleset/cncidr.yaml',
                  interval: 86400
              },
              'applications': {
                  type: 'http',
                  behavior: 'classical',
                  url: 'https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt',
                  path: './ruleset/applications.yaml',
                  interval: 86400
              },
              'Microsoft': {
                  type: 'http',
                  behavior: 'classical',
                  url: "https://cdn.jsdelivr.net/gh/zhanyeye/clash-rules-lite@release/microsoft-rules.txt",
                  path: './providers/rule-microsoft.yaml',
                  interval: 86400
              }
          };
      
          newobj['rule-providers'] = newRuleProviders;
      
      
          //////////////////////  rules  //////////////////////
          const newRules = [
              // å±€åŸŸç½‘
              'IP-CIDR,0.0.0.0/8,DIRECT,no-resolve',
              'IP-CIDR,10.0.0.0/8,DIRECT,no-resolve',
              'IP-CIDR,100.64.0.0/10,DIRECT,no-resolve',
              'IP-CIDR,127.0.0.0/8,DIRECT,no-resolve',
              'IP-CIDR,169.254.0.0/16,DIRECT,no-resolve',
              'IP-CIDR,172.16.0.0/12,DIRECT,no-resolve',
              'IP-CIDR,192.0.0.0/24,DIRECT,no-resolve',
              'IP-CIDR,192.0.2.0/24,DIRECT,no-resolve',
              'IP-CIDR,192.88.99.0/24,DIRECT,no-resolve',
              'IP-CIDR,192.168.0.0/16,DIRECT,no-resolve',
              'IP-CIDR,198.18.0.0/15,DIRECT,no-resolve',
              'IP-CIDR,198.51.100.0/24,DIRECT,no-resolve',
              'IP-CIDR,203.0.113.0/24,DIRECT,no-resolve',
              'IP-CIDR,224.0.0.0/3,DIRECT,no-resolve',
              'IP-CIDR,::/127,DIRECT,no-resolve',
              'IP-CIDR,fc00::/7,DIRECT,no-resolve',
              'IP-CIDR,fe80::/10,DIRECT,no-resolve',
              'IP-CIDR,ff00::/8,DIRECT,no-resolve',
      
              //Matlab
              'PROCESS-NAME,MathWorksProductInstaller,DIRECT',
              'PROCESS-NAME,MATLABWindow,DIRECT',
              'DOMAIN,esd.mathworks.com,DIRECT',
              'DOMAIN-SUFFIX,mathworks.com,é»˜è®¤ä»£ç†',
      
              //steam
              'DOMAIN-KEYWORD,steamcloud,é»˜è®¤ä»£ç†',
              'DOMAIN,steamcommunity.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,steampowered.com,é»˜è®¤ä»£ç†',
              'PROCESS-NAME,steam,DIRECT',
      
              //é»˜è®¤ä»£ç† 
              'PROCESS-NAME,Clash for Windows,é»˜è®¤ä»£ç†',
              'PROCESS-NAME,cfw,é»˜è®¤ä»£ç†',
              'DOMAIN,esm.ubuntu.com,é»˜è®¤ä»£ç†',
              'DOMAIN,ppa.launchpad.net,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,cloudflarestorage.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,haita.io,é»˜è®¤ä»£ç†',
              'DOMAIN,adaptivesupport.amd.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,pling.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,gnome-look.org,é»˜è®¤ä»£ç†',
              'DOMAIN,Filters.adtidy.org,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,gitkraken.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,nodejs.org,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,npmjs.org,é»˜è®¤ä»£ç†',
              'DOMAIN,cdn.xiaolincoding.com,é»˜è®¤ä»£ç†',
              'DOMAIN,linuxmirrors.cn,é»˜è®¤ä»£ç†',
              'DOMAIN,support.xilinx.com,é»˜è®¤ä»£ç†',
              'DOMAIN,docs.amd.com,é»˜è®¤ä»£ç†',
              'DOMAIN,fba02.fbva-ho0.cc,é»˜è®¤ä»£ç†',
              'DOMAIN,amazonaws.com,é»˜è®¤ä»£ç†',
              'DOMAIN,pypi.org,é»˜è®¤ä»£ç†',
              'DOMAIN,conda.anaconda.org,é»˜è®¤ä»£ç†',
              'DOMAIN,www.freertos.org,é»˜è®¤ä»£ç†',
              'DOMAIN,katex.org,é»˜è®¤ä»£ç†',
              'DOMAIN,ieeexplore.ieee.org,é»˜è®¤ä»£ç†',
              'DOMAIN,jichangtuijian.com,é»˜è®¤ä»£ç†',
              'DOMAIN,plotly.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,gardenparty.one,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,ppgnginx.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,itzmx.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,epicgames.com,é»˜è®¤ä»£ç†',
              'PROCESS-NAME,qbittorrent,é»˜è®¤ä»£ç†',
              'PROCESS-NAME,fdm,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,pythonhosted.org,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,codeium.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,hp.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,acg.rip,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,sublimetext.com,é»˜è®¤ä»£ç†',
              'DOMAIN-SUFFIX,zmyos.com,é»˜è®¤ä»£ç†',
      
              // DIRECT
              'DOMAIN-SUFFIX,entitlenow.com,DIRECT',
              'DOMAIN-SUFFIX,cn.mm.bing.net,DIRECT',
              'DOMAIN,www.bing.com,DIRECT',
              'DOMAIN,cn.bing.com,DIRECT',
              'DOMAIN-KEYWORD,starrycoding,DIRECT',
              'DOMAIN-KEYWORD,eriktse,DIRECT',
              'DOMAIN,oi-wiki.org,DIRECT',
              'DOMAIN,download.epicgames.com,DIRECT',
              'DOMAIN,fastly-download.epicgames.com,DIRECT',
              'DOMAIN,www.asasmr3.com,DIRECT',
              'DOMAIN,cdn2.asmrfx.com,DIRECT',
              'DOMAIN,tx.asmras.net,DIRECT',
              'DOMAIN-KEYWORD,asasmr,DIRECT',
              'DOMAIN,clash.razord.top,DIRECT',
              'DOMAIN,yacd.haishan.me,DIRECT',
      
              //chatgpt
              'DOMAIN,challenges.cloudflare.com,chatgpt',
              'DOMAIN-SUFFIX,chatgpt.com,chatgpt',
              'DOMAIN-SUFFIX,openai.com,chatgpt',
              'DOMAIN,cdn.oaistatic.com,chatgpt',
              'DOMAIN,ccdn.auth0.com,chatgpt',
              'DOMAIN,s.gravatar.com,chatgpt',
              'DOMAIN-KEYWORD,gemini,chatgpt',
              'DOMAIN-KEYWORD,claude,chatgpt',
              'DOMAIN,plausible.midway.run,chatgpt',
      
              //Bing Copilot
              'DOMAIN-SUFFIX,bing.com,bing',
              'DOMAIN-KEYWORD,copilot,bing',
              'DOMAIN-SUFFIX,bingapis.com,bing',
              'DOMAIN-SUFFIX,bingparachute.com,bing',
      
              // æˆ˜ç½‘
              'PROCESS-NAME,Battle.net,æˆ˜ç½‘',
              'DOMAIN,telemetry-in.battle.net,æˆ˜ç½‘',
      
              // ruleset
              // 'RULE-SET,applications,DIRECT',
              'RULE-SET,reject,REJECT',
              'RULE-SET,private,DIRECT',
              'RULE-SET,direct,DIRECT',
              'RULE-SET,cncidr,DIRECT',
              'RULE-SET,proxy,é»˜è®¤ä»£ç†',
              'RULE-SET,tld-not-cn,é»˜è®¤ä»£ç†',
              'RULE-SET,gfw,é»˜è®¤ä»£ç†',
              'RULE-SET,apple,è‹¹æœæœåŠ¡',
              'RULE-SET,Microsoft,å¾®è½¯æœåŠ¡',
      
              'RULE-SET,telegramcidr,Telegram',
              'GEOIP,LAN,DIRECT',
              'GEOIP,CN,DIRECT',
      
              'MATCH,æ¼ç½‘ä¹‹é±¼'
          ];
          if (enable_replace_rules) {
              newobj['rules'] = newRules;
          } else {
              newobj["rules"] = [...newRules, ...obj["rules"]];
          }
      
          return yaml.stringify(newobj)
      }
